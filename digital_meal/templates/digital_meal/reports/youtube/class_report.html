{% extends "digital_meal/reports/base_report.html" %}
{% load static %}

{% block page_title %}Klassenreport YouTube{% endblock %}

{% block report_intro_title %}Klassenreport YouTube{% endblock %}

{% block report_intro_image_path %}{% static 'digital_meal/img/yt_symbol.png' %}{% endblock %}

{% block report_intro_text %}
<p>In diesem Report erfahrt Ihr mehr über die YouTube-Nutzung in eurer Klasse.</p>
<p>Der Report basiert aktuell auf den Daten von {{ n_participants }} Schüler:innen.</p>
{% endblock %}


{% block report_body %}

  <!-- NUTZUNGSINTENSITÄT -->
  <div class="section-container">
    <div class="report-section section-green-background position-relative">

      <div class="report-content">
        <h2>Wie viele Videos hat sich eure Klasse auf YouTube angesehen?</h2>
        <p>
          Seit dem {{ wh_dates_min|date:"d. F Y" }} habt ihr in der Klasse <b class="font-size-highlight" style="color: #465ad9">insgesamt&nbsp;{{ n_vids_overall }}&nbsp;Videos&nbsp;angesehen</b>.</br>
        </p>
        <p>
          Unten findet ihr weitere Zahlen zur zusammengefassten YouTube-Nutzung eurer Klasse.
          Links seht ihr die Zahlen für den gesamten Zeitraum der hochgeladenen Daten, rechts jene für den letzten Monat.
        </p>
        <!-- TODO: Ideal wäre eine Info zur Zeitdauer der angeschauten Videos (insgesamt X Zeit auf YouTube verbracht). -->
        <!-- TODO: Videos von Shorts trennen. -->
        <div class="row justify-content-center pt-5">
          <div class="col-12 col-md-6 p-5" style="background: #52ffa0">
            <div style="height: 90px;">
              <h3>Insgesamt<br><span style="font-size: 1rem">{{ wh_dates_min|date:"d.m.Y" }} bis {{ wh_dates_max|date:"d.m.Y" }}</span></h3>
            </div>
            <p>Angeschaute Videos: {{ n_vids_overall }}</p>
            <p>Angeschaute Shorts: TODO</p>
            <p>Unterschiedliche Videos: {{ n_vids_unique_overall }}</p>
            <p>Durchschnittliche Anzahl Videos: {{ n_vids_mean_overall|floatformat:1 }}</p>
          </div>

          <div class="col-12 col-md-6 p-5" style="background: #94ffc3">
            <div style="height: 90px;">
              <h3>Im letzten Monat<br><span style="font-size: 1rem">{{ wh_int_min_date|date:"d.m.Y" }} bis {{ wh_int_max_date|date:"d.m.Y" }}</span></h3>
            </div>
            <p>Angeschaute Videos: {{ n_vids_interval }}</p>
            <p>Angeschaute Shorts: TODO</p>
            <p>Unterschiedliche Videos: {{ n_vids_unique_interval }}</p>
            <p>Durchschnittliche Anzahl Videos: {{ n_vids_mean_interval|floatformat:1 }}</p>
          </div>
        </div>
        <!-- TODO: Add CH-Vergleich, wenn verfügbar. -->

      </div>

    </div>
  </div>

    <!-- YEARLY USE -->
  {% if dates_plot_days %}
  <div class="section-container">

    <div class="report-section flash-yellow-background position-relative">
      <div class="report-content">
        <h2>Wie hat sich eure YouTube-Nutzung im Zeitverlauf verändert?</h2>
        <div>
          <p>
            Unten seht ihr, wie sich die Anzahl der durchschnittlich pro Person angeschauten Videos über die Zeit verändert.
            Ihr könnt euch die Zahlen pro Tag, Woche, Monat oder Jahr anzeigen lassen.
          </p>
          <!-- TODO: Erklärung/Interpretationshilfe (<p>Für die durchschnittliche Person sieht blabla</p>) -->
        </div>
        <div class="row pb-2 pb-lg-0">
          <div id="date_plot_toggles" class="col-xl-2 col-lg-3 justify-content-evenly align-items-lg-stretch pe-lg-5">
            <div class="row d-flex justify-content-around g-1 g-lg-4 pt-lg-5">
              <div class="col-12 col-sm-4 col-md-3 col-lg-12 "><button class="toggle-btn toggle-btn-active" onClick="toggleButton(this, '#dates_plot_days')">pro Tag</button></div>
              <div class="col-12 col-sm-4 col-md-3 col-lg-12 "><button class="toggle-btn" onClick="toggleButton(this, '#dates_plot_weeks')">pro Woche</button></div>
              <div class="col-12 col-sm-4 col-md-3 col-lg-12 "><button class="toggle-btn" onClick="toggleButton(this, '#dates_plot_months')">pro Monat</button></div>
              <div class="col-12 col-sm-4 col-md-3 col-lg-12 "><button class="toggle-btn" onClick="toggleButton(this, '#dates_plot_years')">pro Jahr</button></div>
            </div>
          </div>
          <div id="date_plot_container" class="col justify-content-center border-bottom-2 w-100">
            <div id="dates_plot_days" class="collapse-dates-plots w-100">{{ dates_plot_days.div | safe }}</div>
            <div id="dates_plot_weeks" class="collapse-dates-plots d-none w-100">{{ dates_plot_weeks.div | safe }}</div>
            <div id="dates_plot_months" class="collapse-dates-plots d-none w-100">{{ dates_plot_months.div | safe }}</div>
            <div id="dates_plot_years" class="collapse-dates-plots d-none w-100">{{ dates_plot_years.div | safe }}</div>
          </div>
        </div>

      </div>
    </div>

  </div>
  {% endif %}


  <!-- DAILY USE -->
  {% if weekday_use_plot %}
  <div class="section-container">
    <!-- TODO: Check datetime logic of Google -->

    <div class="report-section" style="background: #D0C3FF">
      <div class="report-content row">
        <div class="col-12 col-lg-5 pe-5">
          <h2>Wann nutzt ihr YouTube in einer durchschnittlichen Woche am intensivsten?</h2>
          <p class="text-start">
            Die folgende Grafik veranschaulicht die Intensität der durchschnittlichen YouTube-Nutzung in eurer Klasse
            über den Verlauf einer typischen Woche.
          </p>
          <p class="text-start">Oben ist ersichtlich, wie sich die Anzahl angesehener Videos prozentual auf die Wochentage verteilt.</p>
          <p class="text-start">
            Unten seht ihr die durchschnittliche Nutzung pro Tag pro Stunde.
            <b style="border-bottom: 2px solid #ffda3c; background: #ffda3c; padding-left: 5px; padding-right: 5px;">Je dunkler das Feld, desto mehr Videos wurden in dieser Zeitperiode angeschaut.</b>
          </p>
        </div>
        <div class="col-12 col-lg-7 detailed-use-plot">
          <!-- TODO: Berechnungsgrundlage Median -->
          <div class="d-flex justify-content-center">{{ weekday_use_plot.div | safe }}</div>
          <div class="d-flex justify-content-center">{{ hours_plot.div | safe }}</div>
        </div>
      </div>
    </div>

  </div>
  {% endif %}


  <!-- FAVORITE VIDEO -->
  <!-- TODO: Podest übergreifend bei den meisten Personen im Verlauf -->
  {% if fav_video.n_watched > 1 %}
  <div class="section-container">

    <div class="report-section section-green-background overflow-hidden">

        <div class="report-content d-flex flex-row pb-5 align-content-stretch pt-5">
          <div class="ps-5 pe-5 flex-grow-1 d-flex flex-column justify-content-center align-items-center">
            <h2>Dein Lieblingsvideo</h2>
            <p class="text-center">
              Dein Lieblingsvideo<br><b class="font-size-highlight" style="color: #001310; background: #d0c3ff; padding-left: 15px; padding-right: 10px;">{{ fav_video.title }}</b><br>hast du dir <b class="font-size-highlight" style="color: #001310; border-bottom: 3px solid #d0c3ff;">{{ fav_video.n_watched }} mal</b> angesehen.
            </p>
          </div>

          <div class="ps-5 pe-5 flex-grow-1 d-flex justify-content-center align-items-center fav-video-teaser">
            <div style="background-color: #001310; padding: 20px; transform: rotate(135deg);">
              <div style="background-color: #389583; padding: 20px; transform: rotate(15deg);">
                <div style="background-color: #8de4af; padding: 20px; transform: rotate(195deg);">
                  <img src="https://i.ytimg.com/vi/{{ fav_video.id }}/mqdefault.jpg" height="300px;" style="padding: 20px; transform: rotate(15deg);">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

  </div>
  {% endif %}


  <!-- SUBSCRIBED CHANNELS -->
  <div class="section-container">

    <div class="report-section" style="background-color: #e83e3e">
      <div class="report-content" style="color: white">
        <h2>Abonnierte YouTube Kanäle</h2>

        <div>
          <p>Insgesamt habt ihr in eurer Klasse {{ n_subs_unique }} unterschiedliche Kanäle abonniert.</p>
          <p>Im Schnitt folgt ihr {{ n_subs_mean|floatformat:"0" }} Kanälen, wobei {{ n_subs_multiple }} Kanäle von mehr als einer Person abonniert sind.</p>
          <p>Die folgenden Kanäle wurden in eurer Klasse am meisten abonniert:</p>
          <ul>
            {% for key, value in most_popular_channels.items %}
            <li>{{ key }} (von {{ value }} Personen abonniert)</li>
            {% endfor %}
          </ul>
        </div>
        <!-- TODO: Podest Top 3 als Podest; zusätzlich Platz 4 bis 10 als Liste -->
        <div class="d-flex justify-content-center pt-5">{{ channel_plot.div | safe }}</div>
      </div>
    </div>

  </div>


  <!-- CHANNELS -->
  <!-- TODO: Analog zu individuellem Report - Unterschied: Nur Kanäle aufnehmen, die von mindestens 2 Personen geschaut werden. -->
  {% if channel_plot %}
  <div class="section-container">

    <div class="report-section" style="background-color: #e83e3e">
      <div class="report-content" style="color: white">
        <h2>Angeschauten YouTube Kanäle</h2>

        <div>
          <p>
            <span style="background: #1f2833; color: white; padding-left: 5px; padding-right: 5px;">Ihr habt euch Videos von <b class="font-size-highlight" style="color: #1f2833; background: white; padding-left: 5px; padding-right: 5px;">{{ n_distinct_channels }}</b> verschiedenen <b class="font-size-highlight" style="color: #1f2833; background: white; padding-left: 5px; padding-right: 5px;">YouTube
            Kanälen</b> angeschaut.</span>
          </p>
          <p>
            <span style="background: #1f2833; color: white; padding-left: 5px; padding-right: 5px;">In dieser Grafik seht ihr die 20 Kanäle, von denen ihr euch am meisten
            Videos angesehen habt.</span>
          </p>
        </div>
        <div class="d-flex justify-content-center pt-5">{{ channel_plot.div | safe }}</div>
      </div>
    </div>

  </div>
  {% endif %}


  <!-- SEARCHES -->
  {% if n_searches_overall > 0 %}

  <!-- TODO: Mindestens von 2 Personen mit gestemmtem approach. -->
  <div class="section-container">

    <div class="report-section" style="background: #1F2833; color: white">
      <div class="report-content">
        <h2>Nach was ihr in der Klasse gesucht habt</h2>

        <p>
          <span class="font-size-highlight searchbar-font" style="margin-left: 5px; color: #1f2833; border: 1px solid #d2d2d2;  background: white; border-top-left-radius: 40px; border-bottom-left-radius: 40px; padding: 5px 40px 5px 20px;"><b>Ihr habt im Schnitt <span style="border-bottom: 3px solid #66fcf1;">{{ n_searches_mean_overall|floatformat:"0" }} Suchen</span> durchgeführt</b></span><span class="font-size-highlight searchbar-font" style="margin-right: 5px; background: #f8f8f8; border-top-right-radius: 40px; border-bottom-right-radius: 40px; border: 1px solid #d2d2d2;padding: 5px 22px 5px 20px;"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16" style="color: #393939;margin-bottom: 5px;">
  <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
</svg></span>
        </p>
        <p>
          Die am häufigsten verwendeten Suchbegriffe sind:
        </p>

        <div class="d-flex justify-content-center pt-3">
          {{ search_plot.div | safe }}
        </div>
      </div>
    </div>

  </div>
  {% endif %}


  <!-- FOOTER -->
  <div class="section-container">

    <div class="report-section">
      <div class="report-content">
        <h3>Über diesen Report</h3>

        <p>
          Dieser Report ist Teil des Lernmoduls "Digital Meal".
        </p>

        <p>
          <b>Digital Meal</b> und das <b>Data Donation Lab</b> sind Initiativen von Forschenden der Universität Zürich.
          Wir legen grossen Wert auf die Sicherheit Ihrer Daten. In diesem Report sind nur aggregierte
          Werte integriert, die keine Rückschlüsse auf einzelne Person zulassen.
        </p>

        <div class="text-center">
          <img alt="Digital Meal Logo" src="{% static 'digital_meal/img/DigitalMeal_Logo.svg' %}" height="70px">
          <img alt="Data Donation Lab Logo" src="{% static 'digital_meal/img/ddl_logo_black.svg' %}" height="70px">
          <img alt="UZH Logo" src="{% static 'digital_meal/img/UZH_logo.svg' %}" height="70px">
        </div>
      </div>
    </div>

  </div>

{% endblock report_body %}


{% block scripts %}
{{ block.super }}

{{ dates_plot_days.script | safe }}
{{ dates_plot_weeks.script | safe }}
{{ dates_plot_months.script | safe }}
{{ dates_plot_years.script | safe }}
{{ weekday_use_plot.script | safe }}
{{ hours_plot.script | safe }}
{{ channel_plot.script | safe }}
{{ search_plot.script | safe }}

<script>
  function toggleButton(button, target) {
    $('.collapse-dates-plots').addClass('d-none');
    $(target).removeClass('d-none');
    $('.toggle-btn').removeClass('toggle-btn-active');
    $(button).addClass('toggle-btn-active')
  }
</script>

{% endblock %}
